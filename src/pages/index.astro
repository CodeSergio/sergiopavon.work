---
import BaseLayout from '../layouts/BaseLayout.astro';
import { Image } from 'astro:assets';
import portrait from '../assets/retrato.png';
import { SITE_TAGLINE } from '../consts';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 4);

const projects = (await getCollection('projects'))
  .sort((a, b) => b.data.year - a.data.year)
  .slice(0, 4);
---

<BaseLayout title="Sergio Maximiliano Pavón" description={SITE_TAGLINE}>
  <section class="grid gap-10 md:grid-cols-[240px_1fr] md:items-start">
    <div class="reveal-init" data-reveal>
      <Image
        src={portrait}
        alt="Retrato de Sergio Maximiliano Pavón"
        widths={[220, 320]}
        sizes="(max-width: 768px) 220px, 240px"
        class="aspect-square w-[220px] rounded-3xl border border-[var(--border)] bg-[var(--card)] object-cover shadow-sm"
        loading="eager"
      />
      <p class="mt-3 text-xs tracking-wide text-[var(--muted)]">
        Oracle / PL/SQL • SQL avanzado • automatización • producción crítica
      </p>

      <div class="mt-3 flex items-center gap-2">
        <a
          class="icon-btn"
          href="https://www.linkedin.com/in/sergio-maximiliano-pav%C3%B3n-364a9a97/"
          target="_blank"
          rel="noreferrer"
          aria-label="LinkedIn"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            width="18"
            height="18"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <path d="M4 4h16v16H4z" />
            <path d="M7.5 10v7" />
            <path d="M7.5 7.5h.01" />
            <path d="M11 17v-4.2c0-1.6 1-2.6 2.3-2.6c1.4 0 2.2 1 2.2 2.6V17" />
            <path d="M11 10v7" />
          </svg>
        </a>

        <a class="icon-btn" href="https://github.com/CodeSergio" target="_blank" rel="noreferrer" aria-label="GitHub">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            width="18"
            height="18"
            fill="none"
            stroke="currentColor"
            stroke-width="1.8"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <path d="M9 19c-5 1.5-5-2.5-7-3" />
            <path d="M15 22v-3.8a3.4 3.4 0 0 0-1-2.6" />
            <path d="M9 22v-3.8a3.4 3.4 0 0 1 1-2.6" />
            <path d="M14 15.6c3.1-.3 6.4-1.5 6.4-7" />
            <path d="M3.6 8.6c0 5.5 3.3 6.7 6.4 7" />
            <path d="M20.4 8.6a5.4 5.4 0 0 0-1.5-3.8" />
            <path d="M18.9 4.8a5.1 5.1 0 0 0-.1-3.8s-1.2-.4-3.9 1.5" />
            <path d="M14.9 2.5a13.4 13.4 0 0 0-7 0" />
            <path d="M8 2.5C5.3.6 4.1 1 4.1 1a5.1 5.1 0 0 0-.1 3.8" />
            <path d="M4 4.8a5.4 5.4 0 0 0-1.5 3.8" />
          </svg>
        </a>
      </div>
    </div>

    <div class="space-y-6">
      <div class="space-y-3">
        <h1 class="font-display text-3xl leading-tight tracking-tight md:text-5xl reveal-init" data-reveal>
          Backend en producción.
        </h1>
        <p class="text-base leading-relaxed text-[var(--muted)] reveal-init" data-reveal>
          Sistemas Oracle, entornos legacy y operación crítica: automatización, integridad de datos, respuesta a incidentes
          y confiabilidad de punta a punta.
        </p>
        <p class="text-base leading-relaxed text-[var(--muted)] reveal-init" data-reveal>
          Soy Sergio Maximiliano Pavón. Trabajo con PL/SQL, SQL avanzado y Unix/Linux. Me enfoco en estabilidad,
          consistencia y mantenimiento real de sistemas productivos.
        </p>
      </div>

      <div class="flex flex-wrap items-center gap-2 reveal-init" data-reveal>
        <a class="btn btn-primary btn-shimmer" href="/cv">Ver CV</a>
        <a class="btn btn-secondary" href="/proyectos">Ver proyectos</a>
        <a class="btn btn-secondary" href="/blog">Leer blog IA</a>
        <a class="btn btn-secondary" href="/cv/texto">CV en texto</a>
      </div>

      <section class="grid gap-3 sm:grid-cols-2 reveal-init" data-reveal aria-label="Highlights">
        <div class="rounded-2xl border border-[var(--border)] bg-[var(--card)] p-4">
          <h2 class="font-display text-lg">Foco</h2>
          <p class="mt-1 text-sm text-[var(--muted)]">Batch, datos, integridad, conciliaciones y soporte a producción.</p>
        </div>
        <div class="rounded-2xl border border-[var(--border)] bg-[var(--card)] p-4">
          <h2 class="font-display text-lg">Stack</h2>
          <p class="mt-1 text-sm text-[var(--muted)]">Oracle, PL/SQL, SQL tuning, Unix/Linux, Jenkins, Docker, AWS S3.</p>
        </div>
      </section>
    </div>
  </section>

  <section class="mt-14">
    <div class="flex items-baseline justify-between gap-4">
      <h2 class="font-display text-2xl">Noticias de IA (en español)</h2>
      <a class="btn btn-secondary" href="/blog">Ver todas</a>
    </div>
    <div class="mt-5 grid gap-3">
      {posts.map((post) => (
        <article
          class="reveal-init rounded-2xl border border-[var(--border)] bg-[var(--card)] p-4"
          data-reveal
        >
          <h3 class="font-display text-lg leading-snug">{post.data.title}</h3>
          <div class="mt-3 flex flex-col gap-3 sm:flex-row sm:items-start">
            {post.data.cover && (
              <img
                src={post.data.cover}
                alt={post.data.coverAlt ?? `Miniatura: ${post.data.title}`}
                class="h-20 w-32 shrink-0 rounded-xl border border-[var(--border)] object-cover"
                loading="lazy"
              />
            )}
            <div class="min-w-0">
              <p class="text-sm text-[var(--muted)]">{post.data.excerpt}</p>
              <p class="mt-2 text-xs tracking-wide text-[var(--muted)]">
                {post.data.date.toLocaleDateString('es-AR', { year: 'numeric', month: 'short', day: '2-digit' })}
              </p>
              <div class="mt-3">
                <a class="btn btn-secondary" href={`/blog/${post.slug}`}>Leer</a>
              </div>
            </div>
          </div>
        </article>
      ))}
    </div>
  </section>

  <section class="mt-14">
    <div class="flex items-baseline justify-between gap-4">
      <h2 class="font-display text-2xl">Proyectos (habilidades 2026)</h2>
      <a class="btn btn-secondary" href="/proyectos">Ver todos</a>
    </div>
    <div class="mt-5 grid gap-3 sm:grid-cols-2">
      {projects.map((p) => (
        <article
          class="reveal-init rounded-2xl border border-[var(--border)] bg-[var(--card)] p-4"
          data-reveal
        >
          <h3 class="font-display text-lg">{p.data.title}</h3>
          <div class="mt-3 flex flex-col gap-3 sm:flex-row sm:items-start">
            {p.data.cover && (
              <img
                src={p.data.cover}
                alt={p.data.coverAlt ?? `Miniatura: ${p.data.title}`}
                class="h-20 w-32 shrink-0 rounded-xl border border-[var(--border)] object-cover"
                loading="lazy"
              />
            )}
            <div class="min-w-0">
              <p class="text-sm text-[var(--muted)]">{p.data.highlights[0] ?? 'Proyecto para demostrar habilidades.'}</p>
              <p class="mt-2 text-xs tracking-wide text-[var(--muted)]">{p.data.stack.join(' • ')}</p>
              <div class="mt-3">
                <a class="btn btn-secondary" href={`/proyectos/${p.slug}`}>Ver proyecto</a>
              </div>
            </div>
          </div>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>
